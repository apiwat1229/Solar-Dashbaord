(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))w(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&w(c)}).observe(document,{childList:!0,subtree:!0});function D(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function w(n){if(n.ep)return;n.ep=!0;const l=D(n);fetch(n.href,l)}})();const Z="KJ7ARUDREGXJM57D2YVEDY1T8KZ6LISU",Q="4262188",tt=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",et=tt?"/solaredge":"https://monitoringapi.solaredge.com",ot={async fetch(g,d={}){const D=new URLSearchParams({api_key:Z,...d}),w=`${et}/site/${Q}/${g}?${D.toString()}`;console.log(`[API] Fetching: ${w}`);const n=`solar_data_${g}_${JSON.stringify(d)}`,l=sessionStorage.getItem(n);if(l){const{data:c,timestamp:m}=JSON.parse(l);if(Date.now()-m<5*60*1e3)return c}try{const c=await fetch(w,{headers:{Accept:"application/json"}});if(!c.ok){const P=await c.text();throw console.error(`API Error (${c.status}):`,P),new Error(`API request failed with status ${c.status}`)}const m=c.headers.get("content-type");if(!m||!m.includes("application/json")){const P=await c.text();throw console.error("Expected JSON but received:",P.substring(0,100)),new Error("API returned non-JSON response")}const k=await c.json();return sessionStorage.setItem(n,JSON.stringify({data:k,timestamp:Date.now()})),k}catch(c){throw console.error(`Error fetching ${g}:`,c),c}},getDetails(){return this.fetch("details")},getOverview(){return this.fetch("overview")},getPower(g,d){return this.fetch("power",{startTime:g,endTime:d})},getEnergy(g,d,D="DAY"){return this.fetch("energy",{startDate:g,endDate:d,timeUnit:D})},getPowerFlow(){return this.fetch("currentPowerFlow")},getEnvBenefits(){return this.fetch("envBenefits")},getInventory(){return this.fetch("inventory")},getPowerDetails(g,d){return this.fetch("powerDetails",{startTime:g,endTime:d,meters:"PRODUCTION,CONSUMPTION,PURCHASED"})}};window.SolarAPI=ot;const{createApp:at,ref:S,onMounted:nt,computed:C,watch:W,nextTick:R}=Vue;at({setup(){const g=S("dashboard"),d=S("online"),D=S({}),w=S({}),n=S({}),l=S({inverters:[]}),c=S(1),m=S(new Date().toISOString().split("T")[0]),k=()=>{const t=new Date,a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u=String(t.getDate()).padStart(2,"0"),y=a[t.getMonth()],r=t.getFullYear(),p=t.toTimeString().split(" ")[0];return`${u}-${y}-${r} | ${p}`},P=S(k()),z=C(()=>{if(!m.value)return"";const t=new Date(m.value),a=String(t.getDate()).padStart(2,"0"),y=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],r=t.getFullYear();return`${a}-${y}-${r}`});W(m,()=>{I()});const J=C(()=>d.value==="online"?"Online":"Offline"),N=C(()=>{const t=l.value.inverters||[];return`${t.filter(u=>u.status===1||u.status==="1").length}/${t.length}`}),V=C(()=>{var a,u,y;const t=r=>!r||r<=0?"0s":`${Math.max(.5,Math.min(5,10/(r/1e3+.1))).toFixed(2)}s`;return{solar:t((a=w.value.pv)==null?void 0:a.currentPower),grid:t((u=w.value.grid)==null?void 0:u.currentPower),load:t((y=w.value.load)==null?void 0:y.currentPower),ups:"3s",battery:"0s"}}),_=(t,a="W")=>t==null?"0 kW":`${(a&&a.toLowerCase()==="kw"?t:t/1e3).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:2})} kW`,U=t=>t==null?"0.0 KWh":`${(t/1e3).toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})} KWh`,Y=t=>t==null?"0.0 MWh":`${(t/1e6).toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})} MWh`,K=t=>t?t>=1e3?`${(t/1e3).toFixed(2)} t`:`${t.toFixed(2)} kg`:"0 kg",q=t=>t?t.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}):"0",B=S({}),I=async()=>{try{const t=m.value,a=`${t} 00:00:00`,u=`${t} 23:59:59`,y=await SolarAPI.getOverview(),r=await SolarAPI.getPowerFlow(),p=await SolarAPI.getEnvBenefits(),i=await SolarAPI.getInventory(),e=await SolarAPI.getPowerDetails(a,u);D.value=y.overview||{};const o=r.siteCurrentPowerFlow||{};w.value={unit:o.unit,pv:o.PV||o.pv||{},grid:o.GRID||o.grid||{},load:o.LOAD||o.load||{},connections:o.connections||[]},n.value=p.envBenefits||{},l.value=i.Inventory||{inverters:[]},B.value=e||{},P.value=k(),d.value="online",g.value==="dashboard"&&R(()=>M())}catch(t){console.error("Data Load Error:",t),d.value="offline"}};let F=null,O=null,$=null;const M=async()=>{var y;const t=document.getElementById("dailyAreaChart");if(t){F&&F.destroy();const r=B.value,p=((y=r==null?void 0:r.powerDetails)==null?void 0:y.meters)||[],i=s=>{const f=p.find(h=>h.type.toLowerCase()===s.toLowerCase());return f?f.values:[]},e=i("Production"),o=i("Consumption"),b=i("Purchased"),v=[];for(let s=0;s<24;s++)for(let f=0;f<60;f+=15)v.push(`${String(s).padStart(2,"0")}:${String(f).padStart(2,"0")}`);v.push("24:00");const A=s=>{const f={};return s.forEach(h=>{const E=new Date(h.date.replace(" ","T")),G=E.getHours(),H=Math.floor(E.getMinutes()/15)*15,X=`${String(G).padStart(2,"0")}:${String(H).padStart(2,"0")}`;f[X]=(h.value||0)/1e3}),v.map(h=>f[h]!==void 0?f[h]:0)},x=A(e),L=A(o),T=A(b);F=new Chart(t,{type:"line",data:{labels:v,datasets:[{label:"Solar Production",data:x,borderColor:"#ffbb00",backgroundColor:"rgba(255, 187, 0, 0.4)",fill:!0,tension:.4,pointRadius:0,borderWidth:1},{label:"Purchased (PEA)",data:T,borderColor:"#5fbcd3",backgroundColor:"rgba(95, 188, 211, 0.4)",fill:!0,tension:.4,pointRadius:0,borderWidth:1},{label:"Consumption",data:L,borderColor:"#f2726f",backgroundColor:"rgba(242, 114, 111, 0.4)",fill:!0,tension:.4,pointRadius:0,borderWidth:1}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{label:s=>`${s.dataset.label}: ${s.raw.toFixed(2)} kW`}}},scales:{x:{grid:{display:!1},ticks:{color:"#94a3b8",font:{family:"Outfit",size:10},maxTicksLimit:13,autoSkip:!1,callback:function(s,f){const h=this.getLabelForValue(s);return f===0||f===this.chart.data.labels.length-1||f%8===0?h:null}}},y:{stacked:!1,grid:{color:"rgba(226, 232, 240, 0.4)",drawBorder:!1},ticks:{color:"#94a3b8",font:{family:"Outfit",size:10},callback:s=>`${s.toFixed(1)} kW`},title:{display:!0,text:"Power (kW)",color:"#64748b",font:{family:"Outfit",weight:"600",size:12}}}}}})}const a=document.getElementById("dailyBarChart");if(a){O&&O.destroy();const r=[],p=m.value?new Date(m.value):new Date;for(let i=29;i>=0;i--){const e=new Date(p);e.setDate(p.getDate()-i),r.push(e.getDate().toString().padStart(2,"0")+" "+e.toLocaleString("default",{month:"short"}))}O=new Chart(a,{type:"bar",data:{labels:r,datasets:[{label:"Solar",data:Array.from({length:30},()=>Math.random()*80+40),backgroundColor:"rgba(255, 187, 0, 0.4)",borderColor:"#ffbb00",borderWidth:1,borderRadius:4},{label:"PEA",data:Array.from({length:30},()=>Math.random()*250+100),backgroundColor:"rgba(95, 188, 211, 0.4)",borderColor:"#5fbcd3",borderWidth:1,borderRadius:4}]},plugins:[ChartDataLabels],options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:i=>`${i.dataset.label}: ${i.raw.toFixed(1)} kWh`}},datalabels:{color:"#1e293b",font:{weight:"bold",size:9},textAlign:"center",formatter:(i,e)=>{const o=e.chart.data.datasets,b=o[0].data[e.dataIndex]+o[1].data[e.dataIndex];return b===0||i<b*.1?"":(i/b*100).toFixed(0)},anchor:"center",align:"center"}},scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#94a3b8",font:{family:"Outfit",size:10}}},y:{stacked:!0,grid:{color:"rgba(148, 163, 184, 0.1)",drawBorder:!1},title:{display:!0,text:"Energy (kWh)",color:"#64748b",font:{family:"Outfit",weight:"600",size:12}},ticks:{color:"#94a3b8",font:{family:"Outfit",size:10},callback:i=>`${i} kWh`}}}}})}const u=document.getElementById("monthlyBarChart");if(u){$&&$.destroy();const r=[],p=new Date;for(let e=11;e>=0;e--){const o=new Date(p.getFullYear(),p.getMonth()-e,1);r.push(o.toLocaleString("default",{month:"short",year:"numeric"}))}$=new Chart(u,{type:"bar",plugins:[ChartDataLabels],data:{labels:r,datasets:[{label:"Solar",data:r.map(()=>Math.random()*.4+.1),backgroundColor:"rgba(255, 187, 0, 0.4)",borderColor:"#ffbb00",borderWidth:1,borderRadius:4},{label:"PEA",data:r.map(()=>Math.random()*.6+.2),backgroundColor:"rgba(95, 188, 211, 0.4)",borderColor:"#5fbcd3",borderWidth:1,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:20}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>`${e.dataset.label}: ${e.raw.toFixed(2)} MWh`}},datalabels:{color:"#1e293b",font:{weight:"bold",size:9},textAlign:"center",formatter:(e,o)=>{const b=o.chart.data.datasets,v=b[0].data[o.dataIndex]+b[1].data[o.dataIndex];return e<.1?"":(e/v*100).toFixed(0)+"%"},anchor:"center",align:"center"}},scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#94a3b8",font:{family:"Outfit",size:10}}},y:{stacked:!0,grid:{color:"rgba(148, 163, 184, 0.1)",drawBorder:!1},ticks:{color:"#94a3b8",font:{family:"Outfit",size:10},callback:e=>`${e.toFixed(1)} MWh`}}}}});const i={id:"totalsAboveBars",afterDraw:e=>{const{ctx:o,data:b,scales:{x:v,y:A}}=e;if(e.options.plugins.datalabels.display===!1)return;o.save(),o.font="bold 10px Outfit",o.fillStyle="#1e293b",o.textAlign="center";const x=e.getDatasetMeta(0),L=e.getDatasetMeta(1);b.labels.forEach((T,s)=>{const f=b.datasets[0].data[s]+b.datasets[1].data[s],h=x.data[s].x,E=Math.min(x.data[s].y,L.data[s].y)-10;o.fillText(`${f.toFixed(1)} MWh`,h,E)}),o.restore()}};$.config.plugins.push(i)}};W(g,t=>{t==="dashboard"&&R(()=>M()),typeof lucide<"u"&&lucide.createIcons()}),W(m,(t,a)=>{t!==a&&I()});const j=()=>{if(window.electronAPI){const t=document.getElementById("btn-minimize"),a=document.getElementById("btn-maximize"),u=document.getElementById("btn-close");t&&t.addEventListener("click",()=>window.electronAPI.minimize()),a&&a.addEventListener("click",()=>window.electronAPI.toggleMaximize()),u&&u.addEventListener("click",()=>window.electronAPI.close())}else console.log("Electron API not found. Window controls disabled.")};return nt(()=>{j(),I().then(()=>{const t=document.getElementById("loading-screen");t&&setTimeout(()=>{t.classList.add("hidden")},500)}),typeof lucide<"u"&&lucide.createIcons(),flatpickr(".hidden-date-input",{dateFormat:"Y-m-d",defaultDate:m.value,disableMobile:!0,onChange:(t,a)=>{m.value=a}}),setInterval(I,5*60*1e3),document.addEventListener("fullscreenchange",()=>{window.dispatchEvent(new Event("resize")),setTimeout(()=>{M()},100)})}),{activeTab:g,connectionStatus:d,connectionStatusText:J,overview:D,powerFlow:w,envBenefits:n,inventory:l,chartDays:c,selectedDate:m,lastUpdateTime:P,formatPower:_,formatEnergy:U,formatEnergyMWh:Y,formatCo2:K,formatRevenue:q,flowSpeeds:V,inverterStatusSummary:N,loadDashboardData:I,formattedSelectedDate:z,toggleFullScreen:()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen().catch(t=>{console.error(`Error attempting to enable full-screen mode: ${t.message} (${t.name})`)})}}}}).mount("#app");
