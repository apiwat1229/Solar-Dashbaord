(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))p(i);new MutationObserver(i=>{for(const f of i)if(f.type==="childList")for(const k of f.addedNodes)k.tagName==="LINK"&&k.rel==="modulepreload"&&p(k)}).observe(document,{childList:!0,subtree:!0});function b(i){const f={};return i.integrity&&(f.integrity=i.integrity),i.referrerPolicy&&(f.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?f.credentials="include":i.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function p(i){if(i.ep)return;i.ep=!0;const f=b(i);fetch(i.href,f)}})();const ce="KJ7ARUDREGXJM57D2YVEDY1T8KZ6LISU",de="4262188",ue=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1",fe=ue?"/solaredge":"https://monitoringapi.solaredge.com",me={details:60*60*1e3,overview:15*60*1e3,power:15*60*1e3,energy:24*60*60*1e3,currentPowerFlow:10*60*1e3,envBenefits:12*60*60*1e3,inventory:12*60*60*1e3,powerDetails:15*60*1e3},ge={async fetch(m,u={}){const b=new URLSearchParams({api_key:ce,...u}),p=`${fe}/site/${de}/${m}?${b.toString()}`,i=`solar_data_${m}_${JSON.stringify(u)}`,f=`solar_last_success_${m}`,k=localStorage.getItem("solar_api_blocked_until");if(k&&Date.now()<parseInt(k)){let h=localStorage.getItem(i);if(h||(h=localStorage.getItem(f),h&&console.log(`[API] Throttled - Falling back to last successful ${m}`)),h)return JSON.parse(h).data;throw new Error(`API rate limited until ${new Date(parseInt(k)).toLocaleTimeString()}`)}const S=localStorage.getItem(i);if(S){const{data:h,timestamp:v}=JSON.parse(S),C=me[m]||15*60*1e3;if(Date.now()-v<C)return console.log(`[API] Cache Hit: ${m}`),h}console.log(`[API] Fetching: ${p}`);try{const h=await fetch(p,{headers:{Accept:"application/json"}});if(h.status===429){const R=Date.now()+36e5;throw localStorage.setItem("solar_api_blocked_until",R.toString()),new Error("API Daily limit quota exceeded.")}if(!h.ok)throw new Error(`API request failed with status ${h.status}`);const v=await h.json(),C={data:v,timestamp:Date.now()};return localStorage.setItem(i,JSON.stringify(C)),localStorage.setItem(f,JSON.stringify(C)),localStorage.removeItem("solar_api_blocked_until"),v}catch(h){const v=localStorage.getItem(f);if(v)return console.warn(`[API] Using last success fallback for ${m}`),JSON.parse(v).data;throw h}},getDetails(){return this.fetch("details")},getOverview(){return this.fetch("overview")},getPower(m,u){return this.fetch("power",{startTime:m,endTime:u})},getEnergy(m,u,b="DAY"){return this.fetch("energyDetails",{startTime:m,endTime:u,timeUnit:b,meters:"PRODUCTION,PURCHASED"})},getPowerFlow(){return this.fetch("currentPowerFlow")},getEnvBenefits(){return this.fetch("envBenefits")},getInventory(){return this.fetch("inventory")},getPowerDetails(m,u){return this.fetch("powerDetails",{startTime:m,endTime:u,meters:"PRODUCTION,CONSUMPTION,PURCHASED"})}};window.SolarAPI=ge;const{createApp:he,ref:y,onMounted:pe,computed:W,watch:j,nextTick:q}=Vue;he({setup(){const m=y("dashboard"),u=y("online"),b=y({}),p=y({}),i=y({}),f=y({inverters:[]}),k=y(1),S=y(new Date().toISOString().split("T")[0]),h=()=>{const e=new Date,n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=String(e.getDate()).padStart(2,"0"),r=n[e.getMonth()],g=e.getFullYear(),I=e.toTimeString().split(" ")[0];return`${a}-${r}-${g} | ${I}`},v=y(h()),C=W(()=>{if(!S.value)return"";const e=new Date(S.value),n=String(e.getDate()).padStart(2,"0"),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],g=e.getFullYear();return`${n}-${r}-${g}`}),R=W(()=>{if(u.value==="throttled"){const e=localStorage.getItem("solar_api_blocked_until");return e?`Throttled (until ${new Date(parseInt(e)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})`:"Rate Limited"}return u.value==="online"?"Online":"Offline"}),G=W(()=>{const e=f.value.inverters||[];return`${e.filter(a=>a.status===1||a.status==="1").length}/${e.length}`}),X=W(()=>{var n,a,r;const e=g=>!g||g<=0?"0s":`${Math.max(.5,Math.min(5,10/(g/1e3+.1))).toFixed(2)}s`;return{solar:e((n=p.value.pv)==null?void 0:n.currentPower),grid:e((a=p.value.grid)==null?void 0:a.currentPower),load:e((r=p.value.load)==null?void 0:r.currentPower),ups:"3s",battery:"0s"}}),Z=(e,n="W")=>{if(e==null)return"0 kW";let a=n&&n.toLowerCase()==="kw"?e:e/1e3;const g=Math.abs(a)<10?2:0;return`${a.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:g})} kW`},Q=e=>e==null?"0.0 KWh":`${(e/1e3).toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})} KWh`,ee=e=>e==null?"0.0 MWh":`${(e/1e6).toLocaleString(void 0,{minimumFractionDigits:1,maximumFractionDigits:1})} MWh`,te=e=>e?e>=1e3?`${(e/1e3).toFixed(2)} t`:`${e.toFixed(2)} kg`:"0 kg",oe=e=>e?e.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0}):"0",x=y({}),V=y([]),Y=y([]),z=y(!1),ae=()=>{if(Object.keys(b.value).length===0&&(b.value={lastDayData:{energy:45200},lastMonthData:{energy:125e4},lifeTimeData:{energy:154e5},currentPower:{power:5200}}),Object.keys(p.value).length===0&&(p.value={unit:"W",pv:{currentPower:5200},grid:{currentPower:1200},load:{currentPower:4e3},connections:[{from:"PV",to:"LOAD"},{from:"GRID",to:"LOAD"}]}),!x.value.powerDetails){const e=[],n=[],a=[];for(let r=0;r<96;r++){const g=`${S.value} ${String(Math.floor(r/4)).padStart(2,"0")}:${String(r%4*15).padStart(2,"0")}:00`,I=r>28&&r<68?Math.sin((r-28)/40*Math.PI)*7e3:0,A=1500+Math.random()*2e3;e.push({date:g,value:I}),n.push({date:g,value:A}),a.push({date:g,value:Math.max(0,A-I)})}x.value={powerDetails:{meters:[{type:"Production",values:e},{type:"Consumption",values:n},{type:"Purchased",values:a}]}}}},O=async()=>{let e=!1,n=!1;const a=async(c,d,P)=>{try{const w=await c();w&&(d.value=P?P(w):w)}catch(w){w.message.includes("limit")||w.message.includes("rate limited")?n=!0:(console.error("Error loading data:",w),e=!0)}},r=S.value,g=`${r} 00:00:00`,I=`${r} 23:59:59`,A=new Date;A.setDate(A.getDate()-29);const L=new Date;L.setMonth(L.getMonth()-11);const D=A.toISOString().split("T")[0],M=L.toISOString().split("T")[0].substring(0,7)+"-01";await Promise.allSettled([a(()=>SolarAPI.getOverview(),b,c=>c.overview||{}),a(()=>SolarAPI.getPowerFlow(),p,c=>{const d=c.siteCurrentPowerFlow||{};return{unit:d.unit,pv:d.PV||{},grid:d.GRID||{},load:d.LOAD||{},connections:d.connections||[]}}),a(()=>SolarAPI.getEnvBenefits(),i,c=>c.envBenefits||{}),a(()=>SolarAPI.getInventory(),f,c=>c.Inventory||{inverters:[]}),a(()=>SolarAPI.getPowerDetails(g,I),x),a(()=>SolarAPI.getEnergy(D+" 00:00:00",r+" 23:59:59","DAY"),V,c=>{var d;return((d=c.energyDetails)==null?void 0:d.meters)||[]}),a(()=>SolarAPI.getEnergy(M+" 00:00:00",r+" 23:59:59","MONTH"),Y,c=>{var d;return((d=c.energyDetails)==null?void 0:d.meters)||[]})]),z.value=!1,n?(u.value="throttled",(Object.keys(b.value).length===0||!x.value.powerDetails)&&(ae(),z.value=!0)):e?u.value="offline":u.value="online",v.value=h(),m.value==="dashboard"&&q(()=>U())},ne=()=>{localStorage.removeItem("solar_api_blocked_until"),O()};let N=null,J=null,F=null;const U=async()=>{var r,g,I,A,L;const e=document.getElementById("dailyAreaChart");if(e){N&&N.destroy();const D=x.value,M=((r=D==null?void 0:D.powerDetails)==null?void 0:r.meters)||[],c=t=>{const o=M.find(l=>l.type.toLowerCase()===t.toLowerCase());return o?o.values:[]},d=c("Production"),P=c("Consumption"),w=c("Purchased"),E=[];for(let t=0;t<24;t++)for(let o=0;o<60;o+=15)E.push(`${String(t).padStart(2,"0")}:${String(o).padStart(2,"0")}`);E.push("24:00");const s=t=>{const o={};return t.forEach(l=>{const $=new Date(l.date.replace(" ","T")),B=$.getHours(),_=Math.floor($.getMinutes()/15)*15,K=`${String(B).padStart(2,"0")}:${String(_).padStart(2,"0")}`;o[K]=(l.value||0)/1e3}),E.map(l=>o[l]!==void 0?o[l]:0)};N=new Chart(e,{type:"line",data:{labels:E,datasets:[{label:"Solar Production",data:s(d),backgroundColor:"#5fbcd3",fill:!0,tension:.4,pointRadius:0,borderWidth:0,order:1},{label:"Consumption",data:s(P),backgroundColor:"#f2726f",fill:!0,tension:.4,pointRadius:0,borderWidth:0,order:2},{label:"Purchased (PEA)",data:s(w),backgroundColor:"#22c55e",fill:!0,tension:.4,pointRadius:0,borderWidth:0,order:3}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{label:t=>`${t.dataset.label}: ${t.raw.toFixed(2)} kW`}}},scales:{x:{grid:{display:!1},ticks:{color:"#94a3b8",font:{size:10},maxTicksLimit:13}},y:{grid:{color:"rgba(226, 232, 240, 0.4)",drawBorder:!1},ticks:{color:"#94a3b8",font:{size:10},callback:t=>`${Math.round(t).toLocaleString()} kW`}}}}})}const n=document.getElementById("dailyBarChart");if(n){J&&J.destroy();const D=V.value||[],M=((g=D.find(s=>s.type.toLowerCase()==="production"))==null?void 0:g.values)||[],c=((I=D.find(s=>s.type.toLowerCase()==="purchased"))==null?void 0:I.values)||[],d=[...M].sort((s,t)=>new Date(s.date)-new Date(t.date)),P=d.map(s=>{const t=new Date(s.date);return t.getDate().toString().padStart(2,"0")+" "+t.toLocaleString("default",{month:"short"})}),w=d.map(s=>(s.value||0)/1e3),E=P.map(s=>{const t=c.find(o=>{const l=new Date(o.date);return l.getDate().toString().padStart(2,"0")+" "+l.toLocaleString("default",{month:"short"})===s});return t?(t.value||0)/1e3:0});J=new Chart(n,{type:"bar",data:{labels:P,datasets:[{label:"Solar",data:w,backgroundColor:"#5fbcd3",borderWidth:0,borderRadius:4},{label:"PEA",data:E,backgroundColor:"#f2726f",borderWidth:0,borderRadius:4}]},plugins:[ChartDataLabels],options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{label:s=>`${s.dataset.label}: ${s.raw.toFixed(1)} kWh`}},datalabels:{color:"#fff",font:{weight:"bold",size:9},formatter:(s,t)=>{const o=t.chart.data.datasets.reduce((l,$)=>l+$.data[t.dataIndex],0);return o>0&&s>o*.1?(s/o*100).toFixed(0):""},anchor:"center",align:"center"}},scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#94a3b8",font:{size:10}}},y:{stacked:!0,grid:{color:"rgba(148, 163, 184, 0.1)",drawBorder:!1},ticks:{color:"#94a3b8",font:{size:10},callback:s=>`${Math.round(s).toLocaleString()} kWh`},title:{display:!0,text:"Energy (kWh)",color:"#64748b",font:{weight:"600",size:11}}}}}})}const a=document.getElementById("monthlyBarChart");if(a){F&&F.destroy();const D=Y.value||[],M=((A=D.find(t=>t.type.toLowerCase()==="production"))==null?void 0:A.values)||[],c=((L=D.find(t=>t.type.toLowerCase()==="purchased"))==null?void 0:L.values)||[],d=[...M].sort((t,o)=>new Date(t.date)-new Date(o.date)),P=d.map(t=>new Date(t.date).toLocaleString("default",{month:"short",year:"numeric"})),w=d.map(t=>(t.value||0)/1e6),E=P.map(t=>{const o=c.find(l=>new Date(l.date).toLocaleString("default",{month:"short",year:"numeric"})===t);return o?(o.value||0)/1e6:0});F=new Chart(a,{type:"bar",plugins:[ChartDataLabels],data:{labels:P,datasets:[{label:"Solar",data:w,backgroundColor:"#5fbcd3",borderWidth:0,borderRadius:4},{label:"PEA",data:E,backgroundColor:"#f2726f",borderWidth:0,borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,layout:{padding:{top:25}},plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{label:t=>`${t.dataset.label}: ${t.raw.toFixed(2)} MWh`}},datalabels:{color:"#fff",font:{weight:"bold",size:9},formatter:(t,o)=>{const l=o.chart.data.datasets.reduce(($,B)=>$+B.data[o.dataIndex],0);return l>0&&t>l*.1?(t/l*100).toFixed(0)+"%":""},anchor:"center",align:"center"}},scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#94a3b8",font:{size:10}}},y:{stacked:!0,grid:{color:"rgba(148, 163, 184, 0.1)",drawBorder:!1},ticks:{color:"#94a3b8",font:{size:10},callback:t=>`${Math.round(t).toLocaleString()} MWh`},title:{display:!0,text:"Energy (MWh)",color:"#64748b",font:{weight:"600",size:11}}}}}});const s={id:"totalsAboveBars",afterDraw:t=>{const{ctx:o,data:l,scales:{x:$,y:B}}=t;o.save(),o.font="bold 9px Outfit",o.fillStyle="#64748b",o.textAlign="center";const _=t.getDatasetMeta(0),K=t.getDatasetMeta(1);l.labels.forEach((we,T)=>{const H=(l.datasets[0].data[T]||0)+(l.datasets[1].data[T]||0);if(H<=0)return;const ie=_.data[T].x,le=Math.min(_.data[T].y,K.data[T].y)-8;o.fillText(`${H.toFixed(1)} M`,ie,le)}),o.restore()}};F.config.plugins.push(s),F.update()}};j(m,e=>{e==="dashboard"?q(()=>{U(),typeof lucide<"u"&&lucide.createIcons()}):typeof lucide<"u"&&lucide.createIcons()}),j(S,()=>O());const re=()=>{if(window.electronAPI){const e=document.getElementById("btn-minimize"),n=document.getElementById("btn-maximize"),a=document.getElementById("btn-close"),r=document.getElementById("btn-reload");e&&e.addEventListener("click",()=>window.electronAPI.minimize()),n&&n.addEventListener("click",()=>window.electronAPI.toggleMaximize()),a&&a.addEventListener("click",()=>window.electronAPI.close()),r&&r.addEventListener("click",()=>window.electronAPI.reload())}},se=()=>{document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};return pe(()=>{re(),O().then(()=>{const e=document.getElementById("loading-screen");e&&setTimeout(()=>e.classList.add("hidden"),500),typeof lucide<"u"&&lucide.createIcons()}),typeof lucide<"u"&&lucide.createIcons(),flatpickr(".hidden-date-input",{dateFormat:"Y-m-d",defaultDate:S.value,disableMobile:!0,onChange:(e,n)=>{S.value=n}}),setInterval(O,15*60*1e3),document.addEventListener("fullscreenchange",()=>{window.dispatchEvent(new Event("resize")),setTimeout(()=>U(),100)})}),{activeTab:m,connectionStatus:u,connectionStatusText:R,overview:b,powerFlow:p,envBenefits:i,inventory:f,chartDays:k,selectedDate:S,lastUpdateTime:v,formatPower:Z,formatEnergy:Q,formatEnergyMWh:ee,formatCo2:te,formatRevenue:oe,flowSpeeds:X,inverterStatusSummary:G,loadDashboardData:O,forceRefresh:ne,isDemoMode:z,formattedSelectedDate:C,toggleFullScreen:se}}}).mount("#app");
